From andy@andyh.co.uk  Sat Jan 10 07:32:01 2004
Received: from localhost (localhost [127.0.0.1])
	by dansat.data-plan.com (8.12.9/8.12.9) with ESMTP id i0A7VcFZ015087
	for <timbo@localhost>; Sat, 10 Jan 2004 07:32:01 GMT
	(envelope-from andy@andyh.co.uk)
Received: from pop3.mail.demon.net [194.217.242.253]
	by localhost with POP3 (fetchmail-5.8.5)
	for timbo@localhost (single-drop); Sat, 10 Jan 2004 07:32:01 +0000 (GMT)
Received: from punt-3.mail.demon.net by mailstore
	for pobox@dbi.demon.co.uk id 1Af6sq-0006t8-GB;
	Sat, 10 Jan 2004 00:21:44 +0000
Received: from [207.8.214.2] (helo=icicle.pobox.com)
	by punt-3.mail.demon.net with esmtp id 1Af6sq-0006t8-GB
	for pobox@dbi.demon.co.uk; Sat, 10 Jan 2004 00:21:44 +0000
Received: from icicle.pobox.com (localhost [127.0.0.1])
	by icicle.pobox.com (Postfix) with ESMTP id 77CB3A06C
	for <pobox@dbi.demon.co.uk>; Fri,  9 Jan 2004 19:21:43 -0500 (EST)
Delivered-To: tim.bunce@pobox.com
Received: from colander (localhost [127.0.0.1])
	by icicle.pobox.com (Postfix) with ESMTP id 44EFBA063
	for <Tim.Bunce@pobox.com>; Fri,  9 Jan 2004 19:21:43 -0500 (EST)
Received: from mta02-svc.ntlworld.com (mta02-svc.ntlworld.com [62.253.162.42])
	by icicle.pobox.com (Postfix) with ESMTP
	for <Tim.Bunce@pobox.com>; Fri,  9 Jan 2004 19:21:42 -0500 (EST)
Received: from excession ([80.2.244.47]) by mta02-svc.ntlworld.com
          (InterMail vM.4.01.03.37 201-229-121-137-20020806) with SMTP
          id <20040110002128.ZQFM17535.mta02-svc.ntlworld.com@excession>;
          Sat, 10 Jan 2004 00:21:28 +0000
Message-ID: <001e01c3d710$6fc47360$6564a8c0@excession>
From: "Andy Hassall" <andy@andyh.co.uk>
To: "Tim Bunce" <Tim.Bunce@pobox.com>, <dbi-dev@perl.org>
References: <20040109211743.GL1461@dansat.data-plan.com> <014801c3d702$dac97c90$6564a8c0@excession> <20040109234246.GB7364@dansat.data-plan.com>
Subject: Re: DBD::Oracle - update of type_info_all from ODBC?
Date: Sat, 10 Jan 2004 00:26:48 -0000
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2800.1158
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1165
Content-Length: 3528
Lines: 106

Tim Bunce wrote:
> On Fri, Jan 09, 2004 at 10:49:35PM -0000, Andy Hassall wrote:
>> Tim Bunce wrote:
>>> I'd be very grateful if someone could send me the output of:
>>>
>>>   perl -MDBI::DBD::Metadata -e write_typeinfo_pm dbi:ODBC:dsnname
>>> user pass Oracle
>>>
>>> Where dsnname is an ODBC DSN that uses a recent (9.2 or at least
>>> 9.1) Oracle ODBC driver to talk to a similarly recent Oracle
>>> database
>>> server.
>>
>> I might be missing something here, but DBI::DBD::Metadata from DBI
>> 1.40 doesn't appear to have a write_typeinfo_pm sub. It's got
>> write_typeinfo though (line 308).
>>
>> $ perl -MDBI::DBD::Metadata -e write_typeinfo_pm dbi:ODBC:web test
>> test Oracle
>>
>> Undefined subroutine &DBI::DBD::Metadata::write_typeinfo_pm called
>> at -e line 1.
>>
>> write_typeinfo works, but the parameters are in a different order,
>> which had me confused for a bit!
>
> Uh. Bugs in the DBI::DBD docs. Patches welcome :)

 Is it really a doc bug? Metadata has write_typeinfo_pm in @EXPORT but never
defines it, and write_typeinfo is inconsistent with write_getinfo_pm.

 The following sorts that out:

--- Metadata.pm.orig    2004-01-10 00:04:46.598710400 +0000
+++ Metadata.pm 2004-01-10 00:12:03.486924800 +0000
@@ -245,7 +245,7 @@
   }

 Please replace Driver (or "<foo>") with the name of your driver.
-Note that this stub function is generated for you by the write_typeinfo
+Note that this stub function is generated for you by the write_typeinfo_pm
 function, but you must manually transfer the code to Driver.pm.

 =cut
@@ -305,9 +305,9 @@
     return $val;
 }

-sub write_typeinfo
+sub write_typeinfo_pm
 {
-    my ($driver, $dsn, $user, $pass) = @_ ? @_ : @ARGV;
+    my ($dsn, $user, $pass, $driver) = @_ ? @_ : @ARGV;
     my $dbh = DBI->connect($dsn, $user, $pass, {AutoCommit=>1, RaiseError=>1});
     $driver = "<foo>" unless defined $driver;

@@ -316,7 +316,7 @@
 # Transfer this to ${driver}.pm

 # The type_info_all function was automatically generated by
-# DBI::DBD::Metadata::write_typeinfo v$DBI::DBD::Metadata::VERSION.
+# DBI::DBD::Metadata::write_typeinfo_pm v$DBI::DBD::Metadata::VERSION.

 package DBD::${driver}::db;         # This line can be removed once transferred.

@@ -331,7 +331,7 @@
 # Don't forget to add version and intellectual property control information.

 # The \%type_info_all hash was automatically generated by
-# DBI::DBD::Metadata::write_typeinfo v$DBI::DBD::Metadata::VERSION.
+# DBI::DBD::Metadata::write_typeinfo_pm v$DBI::DBD::Metadata::VERSION.

 package DBD::${driver}::TypeInfo;




>> Output attached, command used was:
>>
>> $ perl -MDBI::DBD::Metadata -e "DBI::DBD::Metadata::write_typeinfo
>> 'Oracle','dbi:ODBC:web','test','test'" > TypeInfo.pm
>>
>> $ perl -MDBI -e 'DBI->installed_versions'
>>   Perl            : 5.008001    (MSWin32-x86-multi-thread)
>>   OS              : MSWin32     (4.0)
>>   DBI             : 1.40
>>   DBD::Oracle     : 1.14
>>   DBD::ODBC       : 1.06
>
>> Forgot to mention - Oracle client & server both 9.2.0.4.
>
> Darn it! Where are the various TIMESTAMP and INTERVAL types I was
> expecting to find? Is the ODBC driver manager recent (v3 ODBC specs?)

 Hm, where should I be looking for this? My knowledge of ODBC is fairly
limited. I've updated MDAC to 2.8, the latest version on microsoft.com; I
believe that updates the driver manager? (from what it says on google
searches).

-- 
Andy Hassall <andy@andyh.co.uk> / Space: disk usage analysis tool
<http://www.andyh.co.uk> / <http://www.andyhsoftware.co.uk/space>


